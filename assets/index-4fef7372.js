import{a1 as N,d as O,b as W,a2 as E,c as T,r as m,a3 as M,o as I,A as L,w as a,g as t,h as k,s as b,i as f,k as Z,l as H,n as J,m as j,a4 as Q,_ as X,K as q,e as K,F as ee,z as le,v as te,a5 as ae,a6 as oe,V as se,a7 as D,a8 as ne,a9 as re,aa as ue,ab as ie,ac as de,W as ce,O as me,ad as pe,ae as _e}from"./index-4c180a68.js";/* empty css                      */import{s as fe,u as ge}from"./el-popover-757eb6a2.js";/* empty css                   *//* empty css                   */import{u as Y}from"./acl-c308faa5.js";const ve=(s,p,V)=>N.get(`/admin/acl/user/${s}/${p}`+(V!==""?`?username=${V}`:"")),be=s=>s.id?N.put("/admin/acl/user/update",s):N.post("/admin/acl/user/save",s),Ve=s=>N.get("/admin/acl/user/toAssign/"+s),Ue=s=>N.post("/admin/acl/user/doAssignRole",s),he=s=>N.delete("/admin/acl/user/remove/"+s),we=s=>N.delete("/admin/acl/user/batchRemove",{data:s}),Ce=O({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:p}){const V=s,C=W(),d=E("form",T({id:void 0,username:"",name:"",password:void 0})),n=E("addUser",m(!1)),U=E("getUserInfo",()=>{}),r=M({get:()=>V.modelValue,set:o=>p("update:modelValue",o)}),_=M(()=>n.value?"添加用户":`更新${d.username}`),i=m(),A=T({name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:5,message:"请输入至少5字姓名",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"请输入至少5字用户名",trigger:"blur"}],password:[{required:!0,validator:(o,l,e)=>{n.value?l&&l.length>=6&&l.length<=16?e():e(new Error("请输入6到16位密码")):(l&&(d.password=void 0),e())},trigger:"blur"}]}),R=async()=>{try{await i.value.validate();const o=await be(d),l=n.value?"添加":"更新";o.code===200?C.name===d.username?(f.success("个人信息变更，请重新登录"),window.location.reload()):(U(),r.value=!1,$(),f.success(`${l}用户成功`)):f.error(`${l}用户失败`)}catch{f.error("请检查输入")}};let S=!1;const B=()=>{r.value=!1,S=!0},h=async()=>{n.value?S&&($(),S=!1):$(),i.value.clearValidate()},$=()=>{Object.assign(d,{id:void 0,name:"",username:"",password:void 0}),i.value.clearValidate()};return(o,l)=>{const e=Z,u=H,x=J,w=j,g=Q;return I(),L(g,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=z=>r.value=z),title:_.value,width:"30%",onClosed:h},{footer:a(()=>[t(w,{plain:"",onClick:R},{default:a(()=>[k("提交")]),_:1}),t(w,{plain:"",onClick:B},{default:a(()=>[k("取消")]),_:1})]),default:a(()=>[t(x,{ref_key:"formEl",ref:i,model:b(d),rules:A,"label-width":"auto",class:"edit-form"},{default:a(()=>[t(u,{label:"姓名",prop:"name"},{default:a(()=>[t(e,{modelValue:b(d).name,"onUpdate:modelValue":l[0]||(l[0]=z=>b(d).name=z),modelModifiers:{trim:!0},placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),k(" z ")]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const ye=X(Ce,[["__scopeId","data-v-b112d704"]]);const xe=O({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:p}){const V=s,C=E("form",T({id:void 0,username:"",name:"",password:void 0})),d=E("getUserInfo",()=>{}),n=M({get:()=>V.modelValue,set:o=>p("update:modelValue",o)}),U=m(!1),r=m(!1),_=m(!1),i=m([]),c=[],A=async()=>{U.value=!0;const o=await Ve(C.id);if(o.code===200){const l=o.data.assignRoles,e=o.data.allRolesList;i.value=l,c.splice(0,c.length),c.push(...e),0<l.length&&l.length<e.length&&(_.value=!0)}else f.error("获取角色失败");await fe(500),U.value=!1},R=()=>{i.value=[],c.splice(0,c.length),r.value=!1,_.value=!1},S=o=>{i.value=o?c:[],_.value=!1},B=o=>{const l=o.length;r.value=l===c.length,_.value=l>0&&l<c.length},h=async()=>{const o=i.value.map(e=>e.id);(await Ue({roleIdList:o,userId:C.id})).code===200?(f.success("分配角色成功"),n.value=!1,d()):f.error("分配角色失败")},$=()=>{n.value=!1};return(o,l)=>{const e=ae,u=oe,x=H,w=J,g=j,z=Q,G=se;return I(),L(z,{modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=y=>n.value=y),title:`为${b(C).username}分配角色`,width:"40%",onOpen:A,onClosed:R},{footer:a(()=>[t(g,{plain:"",onClick:h},{default:a(()=>[k("提交")]),_:1}),t(g,{plain:"",onClick:$},{default:a(()=>[k("取消")]),_:1})]),default:a(()=>[q((I(),L(w,null,{default:a(()=>[t(x,null,{default:a(()=>[t(e,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=y=>r.value=y),indeterminate:_.value,onChange:S},{default:a(()=>[k(" 选择全部 ")]),_:1},8,["modelValue","indeterminate"]),t(u,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=y=>i.value=y),onChange:B},{default:a(()=>[(I(),K(ee,null,le(c,y=>t(e,{key:y.id,label:y},{default:a(()=>[k(te(y.roleName),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})),[[G,U.value]])]),_:1},8,["modelValue","title"])}}}),ke=O({__name:"index",setup(s){const p=Y(),V=W(),C=E("getUserInfo",()=>{}),d=E("userInfo",m([])),n=E("total",m(0)),U=T({id:void 0,username:"",name:""}),r=m(!1),_=m(!1),i=m(!1),c=e=>{e?(r.value=!1,R(e)):r.value=!0,_.value=!0},A=e=>{R(e),i.value=!0},R=e=>{Object.assign(U,{id:e.id,username:e.username,name:e.name},{password:void 0})},S=async e=>{(await he(e)).code===200?(f.success("删除成功"),l()):f.error("删除失败")},B=e=>V.name!=e.username,h=m([]),$=e=>{h.value=e},o=async()=>{if(h.value.length===0){f.error("未知错误");return}else if(h.value.length===1){S(h.value[0].id);return}let e=!0;const u=[];for(let w=0;w<h.value.length;w++)if(h.value[w].username===V.name){e=!1;break}else u.push(h.value[w].id);if(!e){f.error("未知错误");return}(await we(u)).code===200?(f.success("删除成功"),l()):f.error("删除失败")},l=async()=>{d.value.length<=1?p.user.pageNo--:C()};return D("form",U),D("addUser",r),(e,u)=>{const x=j,w=re,g=ue,z=ie,G=de,y=ce,F=ne("perm");return I(),K("div",null,[t(ye,{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=v=>_.value=v)},null,8,["modelValue"]),t(xe,{modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=v=>i.value=v),ref:"roleEl"},null,8,["modelValue"]),t(y,{class:"user-list"},{default:a(()=>[q((I(),L(x,{plain:"",onClick:u[2]||(u[2]=()=>c())},{default:a(()=>[k(" 添加用户 ")]),_:1})),[[F,"btn.User.add"]]),q((I(),L(w,{title:"确定要删除这些用户吗？",width:"200px",onConfirm:o},{reference:a(()=>[t(x,{plain:"",disabled:h.value.length<=0},{default:a(()=>[k("批量删除")]),_:1},8,["disabled"])]),_:1})),[[F,"btn.User.remove"]]),t(z,{class:"table",data:b(d),onSelectionChange:$},{default:a(()=>[t(g,{type:"selection",width:"60px",align:"center",selectable:B}),t(g,{label:"#",type:"index",width:"60px",align:"center"}),t(g,{label:"用户名",prop:"username"}),t(g,{label:"姓名",prop:"name","show-overflow-tooltip":""}),t(g,{label:"角色",prop:"roleName","show-overflow-tooltip":""}),t(g,{label:"创建时间",prop:"createTime","show-overflow-tooltip":""}),t(g,{label:"更新时间",prop:"updateTime","show-overflow-tooltip":""}),t(g,{label:"操作",align:"center",width:"160px"},{default:a(({row:v})=>[q(t(x,{plain:"",type:"success",size:"small",icon:"User",title:"分配用户角色",onClick:P=>A(v)},null,8,["onClick"]),[[F,"btn.User.assgin"]]),q(t(x,{plain:"",type:"warning",size:"small",icon:"Edit",title:"编辑用户",onClick:P=>c(v)},null,8,["onClick"]),[[F,"btn.User.update"]]),t(w,{title:`确定要删除${v.username}吗？`,width:"200px",onConfirm:P=>S(v.id)},{reference:a(()=>[q(t(x,{plain:"",type:"danger",size:"small",icon:"Delete",title:"删除用户",disabled:b(V).name==v.username},null,8,["disabled"]),[[F,"btn.User.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),t(G,{pageNo:b(p).user.pageNo,"onUpdate:pageNo":u[3]||(u[3]=v=>b(p).user.pageNo=v),pageSize:b(p).user.pageSize,"onUpdate:pageSize":u[4]||(u[4]=v=>b(p).user.pageSize=v),pageSizes:[5,7,9],total:b(n),pageChange:b(C)},null,8,["pageNo","pageSize","total","pageChange"])]),_:1})])}}});const Se=X(ke,[["__scopeId","data-v-9dc37a4b"]]),qe=O({__name:"index",setup(s){const p=Y(),V=ge();me(()=>{U()});const C=m([]),d=m(0);let n=m("");const U=()=>{V.load(async()=>{const r=await ve(p.user.pageNo,p.user.pageSize,n.value);r.code===200?(C.value=r.data.records,d.value=r.data.total):f.error("获取用户管理数据失败")})};return D("getUserInfo",U),D("userInfo",C),D("total",d),D("keyword",n),(r,_)=>{const i=_e;return I(),K("div",null,[t(i,{modelValue:b(n),"onUpdate:modelValue":_[0]||(_[0]=c=>pe(n)?n.value=c:n=c),doSearch:U,title:"用户名"},null,8,["modelValue"]),t(Se)])}}});export{qe as default};
