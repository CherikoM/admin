import{d as ue,a2 as H,r as d,a3 as ce,a8 as $e,o as y,e as x,K as E,A as Z,w as l,h as J,s as j,g as e,f as K,i as U,m as pe,aa as me,a9 as Oe,ab as _e,ac as ze,ah as Se,a4 as be,V as qe,_ as ge,O as ke,c as oe,y as je,F as X,z as Y,v as ne,L as Q,aq as Ke,am as Be,k as ye,l as Ve,ar as Fe,C as Te,ai as Ge,as as Ae,at as Ie,al as Je,n as he,x as Me,ao as Re,au as We,aj as He,a7 as se,av as Qe,ap as Xe,W as Ye}from"./index-4c180a68.js";import{u as fe,c as Ze,d as et,e as tt,f as lt,g as at,h as st}from"./product-e9a75ffc.js";/* empty css                   *//* empty css                   *//* empty css                      */import{u as ot}from"./el-popover-757eb6a2.js";import{r as nt,a as ut}from"./index-b0c2f30a.js";import{b as rt,o as it}from"./imgUpload-bbe67234.js";const dt={class:"list"},ct=ue({__name:"index",emits:["onAddSku","onEditSpu"],setup(w,{emit:c}){const s=fe(),u=H("show",d(1)),m=H("spus",d([])),S=H("total",d(0)),N=H("getSpus",()=>Promise.resolve()),C=d([]),t=d(!1),r=d(!1),B=ce(()=>C.value.map(L=>L.skuDefaultImg)),M=L=>{u.value=3,c("onAddSku",L)},F=L=>{u.value=2,c("onEditSpu",L)},I=async L=>{const V=await nt(L.id);V.code===200?(t.value=!0,C.value=V.data):U.error("获取SKU失败")},T=async L=>{(await Ze(L.id)).code===200?(U.success("删除成功"),m.value.length<=1?s.spu.pageNo--:await N()):U.error("删除失败")};return(L,V)=>{const $=pe,i=me,_=Oe,v=_e,b=ze,k=Se,G=be,P=$e("perm"),O=qe;return y(),x("div",dt,[E((y(),Z($,{icon:"Plus",onClick:V[0]||(V[0]=p=>F()),disabled:!j(s).spu.select[2]},{default:l(()=>[J(" 添加SPU ")]),_:1},8,["disabled"])),[[P,"btn.Spu.add"]]),e(v,{class:"table",data:j(m)},{default:l(()=>[e(i,{label:"序号",type:"index",align:"center",width:"60px"}),e(i,{label:"名称",prop:"spuName"}),e(i,{label:"描述",prop:"description","show-overflow-tooltip":""}),e(i,{label:"操作",width:"204px",align:"center"},{default:l(({row:p})=>[K("div",null,[E(e($,{plain:"",size:"small",type:"primary",icon:"Plus",title:"添加SKU",onClick:D=>M(p)},null,8,["onClick"]),[[P,"btn.Spu.addsku"]]),E(e($,{plain:"",size:"small",type:"warning",icon:"Edit",title:"修改SPU",onClick:D=>F(p)},null,8,["onClick"]),[[P,"btn.Spu.update"]]),E(e($,{plain:"",size:"small",icon:"View",title:"SKU列表",onClick:D=>I(p)},null,8,["onClick"]),[[P,"btn.Spu.skus"]]),e(_,{title:`确定要删除${p.spuName}吗？`,width:"200px",onConfirm:D=>T(p)},{reference:l(()=>[E(e($,{plain:"",size:"small",type:"danger",icon:"Delete",title:"删除SPU"},null,512),[[P,"btn.Spu.delete"]])]),_:2},1032,["title","onConfirm"])])]),_:1})]),_:1},8,["data"]),e(b,{"current-page":j(s).spu.pageNo,"onUpdate:currentPage":V[1]||(V[1]=p=>j(s).spu.pageNo=p),"page-size":j(s).spu.pageSize,"onUpdate:pageSize":V[2]||(V[2]=p=>j(s).spu.pageSize=p),"page-sizes":[3,5,7,9],small:!0,layout:"total, sizes, ->, prev, pager, next, jumper",total:j(S)},null,8,["current-page","page-size","total"]),e(G,{"append-to-body":"",title:"SKU列表",modelValue:t.value,"onUpdate:modelValue":V[3]||(V[3]=p=>t.value=p)},{default:l(()=>[E((y(),x("div",null,[e(v,{data:C.value},{default:l(()=>[e(i,{label:"名称",prop:"skuName"}),e(i,{label:"价格",prop:"price",width:"80px",align:"center"}),e(i,{label:"重量",prop:"weight",width:"80px",align:"center"}),e(i,{label:"图片",width:"130px",align:"center"},{default:l(({row:p,$index:D})=>[e(k,{src:p.skuDefaultImg||"",width:"100px",height:"100px","preview-src-list":B.value,"initial-index":D,"hide-on-click-modal":!0,"preview-teleported":!0},null,8,["src","preview-src-list","initial-index"])]),_:1})]),_:1},8,["data"])])),[[O,r.value]])]),_:1},8,["modelValue"])])}}});const pt=ge(ct,[["__scopeId","data-v-e00b5fce"]]);const de=(w,c,s)=>{if(w===c)return!0;if(Array.isArray(w)&&Array.isArray(c)){if(w.length!==c.length)return!1;for(let u=0;u<w.length;u++)if(!de(w[u],c[u]))return!1;return!0}else if(Object.prototype.toString.call(w)==="[object Object]"&&Object.prototype.toString.call(c)==="[object Object]"){let u;if(typeof s=="string"&&s!=="")u=[s];else if(s)u=s;else{const m=Object.keys(w),S=Object.keys(c);u=[...new Set([...m,...S])]}for(let m of u)if(!de(w[m],c[m]))return!1;return!0}else return!1},ie=(w,c,s)=>{if(w.length!==c.length)return!1;{let u=typeof s=="string"?[s]:s;for(let m=0;m<w.length;m++)for(let S of u)if(!de(w[m][S],c[m][S],s))return!1;return!0}},mt={class:"add"},_t=["src"],gt=ue({__name:"index",setup(w,{expose:c}){const s=fe();ke(async()=>{await s.getSpuAllAttrs()});const u=H("show",d(1)),m=H("getSpus",()=>{}),S=d();let N;const C=async n=>{const a=await et(n);a.code===200?(Object.assign(t,a.data),t.spuImageList=t.spuImageList.map(g=>({...g,name:g.imgName,url:g.imgUrl})),N=JSON.parse(JSON.stringify(a.data))):U.error("数据获取失败")},t=oe({id:void 0,category3Id:s.spu.select[2],description:"",tmId:0,spuName:"",spuImageList:[],spuPosterList:[],spuSaleAttrList:[]}),B=oe({spuName:[{required:!0,message:"请输入SPU名称",trigger:"blur"}],spuSaleAttrList:[{required:!1,validator:(n,a,g)=>{a==null||a.forEach((A,z)=>{(!A.spuSaleAttrValueList||A.spuSaleAttrValueList.length<=0)&&(p.value=z,g(new Error("请添加属性值")))}),g()},trigger:"blur"}]}),M=async()=>{we()||U.error("请修改内容后再提交"),await S.value.validate();const n=t.id?"修改":"添加";(await tt(t)).code===200?(U.success(n+"成功"),u.value=1,h(),m()):U.error(n+"失败")},F=()=>{u.value=1,h()},I=d(""),T=d(""),L=async(n,a)=>{const g=await s.getAllTrademark(),A=R=>W=>W.tmName.toLowerCase().indexOf(R.toLowerCase())>=0,z=n?g.filter(A(n)):g;a(z)},V=n=>{T.value=n.tmName,t.tmId=n.id},$=()=>{I.value=T.value},i=d(!1),_=d(""),v=n=>{_.value=n.url,i.value=!0},b=(n,a)=>{n.code===200&&(t.spuImageList?(t.spuImageList[t.spuImageList.length-1].imgName=a.name,t.spuImageList[t.spuImageList.length-1].imgUrl=n.data):U.error(n.data))},k=d(""),G=ce(()=>s.spu.allSPUAttr.filter(a=>{var g;return(g=t.spuSaleAttrList)==null?void 0:g.every(A=>A.saleAttrName!==a.name)})),P=d(),O=d(""),p=d(-1),D=()=>{var A;const[n,a]=k.value.split(":"),g=Number(n);(A=t.spuSaleAttrList)==null||A.push({baseSaleAttrId:g,saleAttrName:a,spuSaleAttrValueList:[]}),k.value=""},re=async n=>{var a;p.value=n,await Be(),(a=P.value)==null||a.focus()},le=n=>{O.value&&t.spuSaleAttrList&&(n.spuSaleAttrValueList.every(g=>g.saleAttrValueName!==O.value)?n.spuSaleAttrValueList.push({saleAttrValueName:O.value,baseSaleAttrId:n.baseSaleAttrId}):(U.error("请勿重复属性值"),P.value.focus())),O.value="",p.value=-1},o=n=>(s.trademark.pageNo-1)*s.trademark.pageSize+n+1,h=()=>{Object.assign(t,{id:void 0,category3Id:0,description:"",tmId:0,spuName:"",spuImageList:[],spuPosterList:[],spuSaleAttrList:[]}),T.value="",k.value="",S.value.clearValidate()},we=()=>{if(t.id){const n=()=>{var g,A;const a=t.spuSaleAttrList.length;for(let z=0;z<a;z++){const R=(g=t.spuSaleAttrList[z])==null?void 0:g.spuSaleAttrValueList,W=(A=N.spuSaleAttrList[z])==null?void 0:A.spuSaleAttrValueList;if(Array.isArray(R)&&Array.isArray(W)){if(!ie(R,W,"saleAttrValueName"))return!0}else return!(!R&&!W)}return!1};return t.description!==N.description||t.tmId!==N.tmId||t.spuName!==N.spuName||!ie(t.spuImageList,N.spuImageList,["imgName","imgUrl"])||!ie(t.spuSaleAttrList,N.spuSaleAttrList,"id")||n()}else return t.description!==""||t.tmId!==0||t.spuName!==""||!t.spuImageList||t.spuImageList.length>0||!t.spuSaleAttrList||t.spuSaleAttrList.length>0};return c({getSPUInfo:C}),(n,a)=>{const g=ye,A=Ve,z=Fe,R=je("Plus"),W=Te,Le=Ge,Ne=Ae,Ue=Ie,ee=pe,ae=me,xe=Je,Ee=_e,Ce=he,Pe=be;return y(),x("div",mt,[e(Ce,{ref_key:"formEl",ref:S,model:t,rules:B},{default:l(()=>[e(A,{label:"名称",prop:"spuName"},{default:l(()=>[e(g,{placeholder:"请输入名称",modelValue:t.spuName,"onUpdate:modelValue":a[0]||(a[0]=f=>t.spuName=f)},null,8,["modelValue"])]),_:1}),e(A,{label:"品牌",prop:"tmId"},{default:l(()=>[e(z,{modelValue:I.value,"onUpdate:modelValue":a[1]||(a[1]=f=>I.value=f),"value-key":"tmName",label:"id","fetch-suggestions":L,placeholder:"请选择品牌",onSelect:V,onBlur:$},null,8,["modelValue"])]),_:1}),e(A,{label:"描述",prop:"description"},{default:l(()=>[e(g,{type:"textarea",placeholder:"请输入描述",modelValue:t.description,"onUpdate:modelValue":a[2]||(a[2]=f=>t.description=f)},null,8,["modelValue"])]),_:1}),e(A,{label:"图片",prop:"spuImageList"},{default:l(()=>[e(Le,{"file-list":t.spuImageList,"onUpdate:fileList":a[3]||(a[3]=f=>t.spuImageList=f),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":v,"on-success":b,"before-upload":j(rt)(),"on-error":j(it)()},{default:l(()=>[e(W,null,{default:l(()=>[e(R)]),_:1})]),_:1},8,["file-list","before-upload","on-error"])]),_:1}),e(A,{label:"销售属性",prop:"spuSaleAttrList"},{default:l(()=>[e(Ue,{placeholder:G.value.length?`还有${G.value.length}个属性`:"无",modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=f=>k.value=f)},{default:l(()=>[(y(!0),x(X,null,Y(G.value,f=>(y(),Z(Ne,{value:`${f.id}:${f.name}`,key:f.id,label:f.name},null,8,["value","label"]))),128))]),_:1},8,["placeholder","modelValue"]),e(ee,{disabled:!k.value,icon:"Plus",style:{"margin-left":"10px"},onClick:D},{default:l(()=>[J(" 添加属性值 ")]),_:1},8,["disabled"]),e(Ee,{class:"table",data:t.spuSaleAttrList},{default:l(()=>[e(ae,{label:"序号",width:"60px",type:"index",align:"center",index:o}),e(ae,{label:"属性",width:"120px",prop:"saleAttrName"}),e(ae,{label:"属性值"},{default:l(({row:f,$index:te})=>[K("div",null,[(y(!0),x(X,null,Y(f.spuSaleAttrValueList,(q,De)=>(y(),Z(xe,{class:"tag",key:q.id,closable:"",onClose:At=>{var ve;return(ve=f.spuSaleAttrValueList)==null?void 0:ve.splice(De,1)}},{default:l(()=>[J(ne(q.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),E(e(ee,{type:"plain",size:"small",icon:"Plus",onClick:q=>re(te)},null,8,["onClick"]),[[Q,p.value!==te]]),E(e(g,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=q=>O.value=q),modelModifiers:{trim:!0},ref:p.value===te?"addValueEl":"",onBlur:q=>le(f),onKeyup:Ke(q=>le(f),["enter","native"]),size:"small",placeholder:"请输入属性值",style:{width:"100px"}},null,8,["modelValue","onBlur","onKeyup"]),[[Q,p.value===te]])])]),_:1}),e(ae,{label:"操作",width:"80px",align:"center"},{default:l(({$index:f})=>[e(ee,{plain:"",size:"small",type:"danger",icon:"Delete",onClick:te=>{var q;return(q=t.spuSaleAttrList)==null?void 0:q.splice(f,1)}},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(ee,{onClick:M},{default:l(()=>[J("保存")]),_:1}),e(ee,{onClick:F},{default:l(()=>[J("取消")]),_:1})]),_:1},8,["model","rules"]),e(Pe,{modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=f=>i.value=f)},{default:l(()=>[K("img",{"w-full":"",class:"img-preview",src:_.value,alt:"Preview Image"},null,8,_t)]),_:1},8,["modelValue"])])}}});const ft=ge(gt,[["__scopeId","data-v-1ab36df4"]]);const vt={class:"container"},St={class:"select"},bt={class:"select"},kt=ue({__name:"index",setup(w,{expose:c}){const s=H("show",d(1)),u=d([]),m=d([]),S=d([]),N=async(i,_)=>{const v=await lt(i.id);if(v.code!==200){U.error(v.message);return}const b=await at(i.id);if(b.code!==200){U.error(b.message);return}const k=await Re(_);if(k.code!==200){U.error(k.message);return}u.value=v.data,m.value=b.data,S.value=k.data,r.category3Id=i.category3Id,r.spuId=i.id,r.tmId=i.tmId},C=d(),t=d(),r=oe({id:void 0,category3Id:0,isSale:0,price:0,skuAttrValueList:[],skuDefaultImg:"",skuDesc:"",skuName:"",skuSaleAttrValueList:[],spuId:0,tmId:0,weight:""}),B=(i,_,v)=>{_>0?v():v("请输入正数")},M=oe({price:[{required:!0,validator:B}],skuDefaultImg:[{required:!0,message:"请选择头图"}],skuDesc:[{required:!0,message:"请输入描述"}],skuName:[{required:!0,message:"请输入名称"}],weight:[{required:!0,validator:B}]}),F=ce(()=>u.value.map(i=>i.imgUrl)),I=({row:i})=>i.imgUrl===r.skuDefaultImg?"selected-row":"",T=i=>{t.value.setCurrentRow(i,!0),r.skuDefaultImg=i.imgUrl},L=async()=>{r.skuAttrValueList=S.value.reduce((_,v)=>{if(v.data){const[b,k]=v.data.split(":");_.push({attrId:Number(b),valueId:Number(k)})}return _},[]),r.skuSaleAttrValueList=S.value.reduce((_,v)=>{if(v.data){const[b,k]=v.data.split(":");_.push({saleAttrId:Number(b),saleAttrValueId:Number(k)})}return _},[]),await C.value.validate(),(await ut(r)).code===200?(s.value=1,$()):U.error("提交失败")},V=()=>{s.value=1,$()},$=()=>{Object.assign(r,{id:void 0,category3Id:0,isSale:0,price:0,skuAttrValueList:[],skuDefaultImg:"",skuDesc:"",skuName:"",skuSaleAttrValueList:[],spuId:0,tmId:0,weight:""})};return c({getFormData:N}),(i,_)=>{const v=ye,b=Ve,k=We,G=Ae,P=Ie,O=Se,p=me,D=pe,re=_e,le=he;return y(),x("div",vt,[e(le,{ref_key:"formEl",ref:C,model:r,rules:M},{default:l(()=>[e(b,{label:"名称",prop:"skuName"},{default:l(()=>[e(v,{placeholder:"请输入名称",modelValue:r.skuName,"onUpdate:modelValue":_[0]||(_[0]=o=>r.skuName=o)},null,8,["modelValue"])]),_:1}),e(b,{label:"价格(元)",prop:"price"},{default:l(()=>[e(k,{modelValue:r.price,"onUpdate:modelValue":_[1]||(_[1]=o=>r.price=o),placeholder:"请输入价格",precision:2,title:"","controls-position":"right"},null,8,["modelValue"])]),_:1}),e(b,{label:"重量(g)",prop:"weight"},{default:l(()=>[e(k,{modelValue:r.weight,"onUpdate:modelValue":_[2]||(_[2]=o=>r.weight=o),placeholder:"请输入重量",precision:2,title:"","controls-position":"right"},null,8,["modelValue"])]),_:1}),e(b,{label:"描述",prop:"skuDesc"},{default:l(()=>[e(v,{modelValue:r.skuDesc,"onUpdate:modelValue":_[3]||(_[3]=o=>r.skuDesc=o),placeholder:"请输入描述",type:"textarea"},null,8,["modelValue"])]),_:1}),e(b,{label:"产品属性",prop:"skuAttrValueList"},{default:l(()=>[K("div",St,[(y(!0),x(X,null,Y(S.value,o=>(y(),x("div",{class:"select-item",key:o.id},[K("p",null,ne(o.attrName),1),e(P,{modelValue:o.data,"onUpdate:modelValue":h=>o.data=h,class:"select-box",placeholder:"请选择"+o.attrName},{default:l(()=>[(y(!0),x(X,null,Y(o.attrValueList,h=>(y(),Z(G,{key:h.id,label:h.valueName,value:`${o.id}:${h.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),_:1}),m.value&&m.value.length>0?(y(),Z(b,{key:0,label:"销售属性",prop:"skuSaleAttrValueList"},{default:l(()=>[K("div",bt,[(y(!0),x(X,null,Y(m.value,o=>(y(),x("div",{class:"select-item",key:o.id},[K("p",null,ne(o.saleAttrName),1),e(P,{modelValue:o.data,"onUpdate:modelValue":h=>o.data=h,class:"select-box",placeholder:"请选择"+o.saleAttrName},{default:l(()=>[(y(!0),x(X,null,Y(o.spuSaleAttrValueList,h=>(y(),Z(G,{key:h.id,label:h.saleAttrValueName,value:`${o.id}:${h.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),_:1})):Me("",!0),e(b,{label:"头图",prop:"skuDefaultImg"},{default:l(()=>[e(re,{class:"table",data:u.value,ref_key:"tableEl",ref:t,"row-class-name":I},{default:l(()=>[e(p,{label:"图片",width:"130px",align:"center"},{default:l(({row:o,$index:h})=>[e(O,{src:o.imgUrl||"",width:"100px",height:"100px","preview-src-list":F.value,"initial-index":h,"hide-on-click-modal":!0,"preview-teleported":!0},null,8,["src","preview-src-list","initial-index"])]),_:1}),e(p,{label:"文件名",prop:"imgName"}),e(p,{label:"操作",width:"140px",align:"center"},{default:l(({row:o})=>[E(e(D,{plain:"",type:"default",onClick:h=>T(o)},{default:l(()=>[J(" 设为默认 ")]),_:2},1032,["onClick"]),[[Q,r.skuDefaultImg!==o.imgUrl]]),E(K("p",null,"默认图片",512),[[Q,r.skuDefaultImg==o.imgUrl]])]),_:1})]),_:1},8,["data"])]),_:1}),e(D,{type:"plain",onClick:L},{default:l(()=>[J("保存")]),_:1}),e(D,{type:"plain",onClick:V},{default:l(()=>[J("取消")]),_:1})]),_:1},8,["model","rules"])])}}});const yt=ge(kt,[["__scopeId","data-v-c42949f3"]]),Vt={class:"card-header"},Ct=ue({__name:"index",setup(w){const c=fe(),s=ot();ke(()=>{c.spu.select[2]&&r()});const u=d(1),m=d("添加SPU"),S=d([]),N=d(0),C=d(),t=d(),r=()=>{S.value=[],c.spu.select[2]&&s.load(async()=>{const I=await st(c.spu.pageNo,c.spu.pageSize,c.spu.select[2]);I.code===200?(S.value=I.data.records,N.value=I.data.total):U.error("获取SPU失败")})},B=async()=>{r()};He(()=>[c.spu.pageNo,c.spu.pageSize],r);const M=I=>{I?s.load(async()=>{C.value.getSPUInfo(I.id),m.value="修改SPU"}):m.value="添加SPU",u.value=2},F=async I=>{await s.load(async()=>{console.log(t),await t.value.getFormData(I,c.spu.select),m.value="添加SKU",u.value=3})};return se("show",u),se("spus",S),se("total",N),se("getSpus",r),(I,T)=>{const L=Xe,V=Ye;return y(),x("div",null,[e(L,{select:j(c).spu.select,disabled:u.value!==1,onChange:B},null,8,["select","disabled"]),e(V,null,Qe({default:l(()=>[E(e(pt,{onOnEditSpu:M,onOnAddSku:F},null,512),[[Q,u.value===1]]),E(e(ft,{ref_key:"editEl",ref:C},null,512),[[Q,u.value===2]]),E(e(yt,{ref_key:"addEl",ref:t},null,512),[[Q,u.value===3]])]),_:2},[u.value!==1?{name:"header",fn:l(()=>[K("div",Vt,[K("span",null,ne(m.value),1)])]),key:"0"}:void 0]),1024)])}}});export{Ct as default};
