import{a1 as z,d as I,a2 as x,c as B,r as m,a3 as M,o as T,A,w as p,g as l,h as q,s as u,i as C,k as P,l as H,n as W,m as F,a4 as O,_ as j,K as w,af as J,V as Q,a7 as $,a8 as X,e as G,f as Y,L as Z,aa as ee,a9 as le,ab as oe,ac as te,W as ae,O as ne,ad as se,ae as re}from"./index-4c180a68.js";/* empty css                      */import{u as ie}from"./el-popover-757eb6a2.js";/* empty css                   *//* empty css                   */import{g as ce}from"./getIndex-0f002f63.js";import{u as L}from"./acl-c308faa5.js";const de=(r,n,V)=>z.get(`/admin/acl/role/${r}/${n}`+(V!==""?`?username=${V}`:"")),ue=r=>r.id?z.put("/admin/acl/role/update",r):z.post("/admin/acl/role/save",r),me=r=>z.get("/admin/acl/permission/toAssign/"+r),pe=(r,n)=>z.post(`/admin/acl/permission/doAssign/?roleId=${r}&permissionId=${n}`),_e=r=>z.delete("/admin/acl/role/remove/"+r),fe=I({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:n}){const V=r,c=x("form",B({id:void 0,roleName:""})),k=x("origin",m("")),s=x("addRole",m(!1)),_=x("getRoles",()=>{}),t=M({get:()=>V.modelValue,set:a=>n("update:modelValue",a)}),b=M(()=>s.value?"添加角色":`更新${c.roleName}`),f=m(),D=B({roleName:[{required:!0,min:1,message:"请输入角色名",trigger:"blur"},{validator:(a,o,g)=>{o===k.value?g(new Error("请更改输入")):g()},trigger:"blur"}]}),h=async()=>{try{await f.value.validate();const a=await ue(c),o=s.value?"添加":"更新";a.code===200?(_(),t.value=!1,e(),C.success(`${o}角色成功`)):C.error(`${o}角色失败`)}catch{C.error("请检查输入")}};let S=!1;const U=()=>{t.value=!1,S=!0},d=async()=>{s.value?S&&(e(),S=!1):e(),f.value.clearValidate()},e=()=>{Object.assign(c,{id:void 0,roleName:""}),f.value.clearValidate()};return(a,o)=>{const g=P,y=H,R=W,v=F,E=O;return T(),A(E,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=i=>t.value=i),title:b.value,width:"30%",onClosed:d},{footer:p(()=>[l(v,{plain:"",onClick:h},{default:p(()=>[q("提交")]),_:1}),l(v,{plain:"",onClick:U},{default:p(()=>[q("取消")]),_:1})]),default:p(()=>[l(R,{ref_key:"formEl",ref:f,model:u(c),rules:D,"label-width":"auto",class:"edit-form"},{default:p(()=>[l(y,{label:"角色名",prop:"roleName"},{default:p(()=>[l(g,{modelValue:u(c).roleName,"onUpdate:modelValue":o[0]||(o[0]=i=>u(c).roleName=i),modelModifiers:{trim:!0},placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const ge=j(fe,[["__scopeId","data-v-e598f525"]]);const ve=I({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:n}){const V=r,c=x("form",B({id:void 0,roleName:""})),k=x("getRoles",()=>{}),s=M({get:()=>V.modelValue,set:e=>n("update:modelValue",e)}),_=m(!1),t=[],b=e=>{const a=[],o=(g,y)=>{for(let R=0;R<g.length;R++){const v=g[R];v.children&&v.children.length>0?o(v.children,y):v.select&&y.push(v.id)}return y};return o(e,a)},f=async()=>{_.value=!0;const e=await me(c.id);e.code===200?(h.value=e.data,t.push(...b(e.data))):C.error("获取菜单失败"),_.value=!1},N=m(),D={label:"name",children:"children"},h=m([]),S=()=>{h.value=[],t.length=0},U=async()=>{const e=N.value.getCheckedKeys(),a=N.value.getHalfCheckedKeys();console.log(e,a,t),(await pe(c.id,e.concat(a))).code===200?(C.success("分配权限成功"),s.value=!1,k()):C.error("分配权限失败")},d=()=>{s.value=!1};return(e,a)=>{const o=J,g=F,y=O,R=Q;return T(),A(y,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=v=>s.value=v),title:`为${u(c).roleName}分配权限`,width:"40%",onOpen:f,onClosed:S},{footer:p(()=>[l(g,{plain:"",onClick:U},{default:p(()=>[q("提交")]),_:1}),l(g,{plain:"",onClick:d},{default:p(()=>[q("取消")]),_:1})]),default:p(()=>[w(l(o,{props:D,data:h.value,"show-checkbox":"","default-checked-keys":t,"node-key":"id",accordion:"",ref_key:"tree",ref:N},null,8,["data"]),[[R,_.value]])]),_:1},8,["modelValue","title"])}}}),Ve=I({__name:"index",setup(r){const n=L(),V=x("getRoles",()=>{}),c=x("roles",m([])),k=x("total",m(0)),s=m(""),_=B({id:void 0,roleName:""}),t=m(!1),b=m(!1),f=m(!1),N=d=>{d?(t.value=!1,h(d),s.value=d.roleName):(t.value=!0,s.value=""),b.value=!0},D=d=>{h(d),f.value=!0},h=d=>{_.id=d.id,_.roleName=d.roleName},S=async d=>{(await _e(d)).code===200?(C.success("删除成功"),U()):C.error("删除失败")},U=async()=>{c.value.length<=1?n.role.pageNo--:V()};return $("form",_),$("addRole",t),$("origin",s),(d,e)=>{const a=F,o=ee,g=le,y=oe,R=te,v=ae,E=X("perm");return T(),G("div",null,[l(ge,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=i=>b.value=i)},null,8,["modelValue"]),l(ve,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=i=>f.value=i),ref:"roleEl"},null,8,["modelValue"]),l(v,{class:"user-list"},{default:p(()=>[w((T(),A(a,{plain:"",onClick:e[2]||(e[2]=()=>N())},{default:p(()=>[q(" 添加角色 ")]),_:1})),[[E,"btn.Role.add"]]),l(y,{class:"table",data:u(c)},{default:p(()=>[l(o,{label:"#",type:"index",width:"60px",align:"center",index:u(ce)(u(n).role.pageNo,u(n).role.pageSize)},null,8,["index"]),l(o,{label:"角色名",prop:"roleName"}),l(o,{label:"创建时间",prop:"createTime","show-overflow-tooltip":""}),l(o,{label:"更新时间",prop:"updateTime","show-overflow-tooltip":""}),l(o,{label:"操作",align:"center",width:"160px"},{default:p(({row:i})=>[w(Y("div",null,[w(l(a,{plain:"",type:"success",size:"small",icon:"User",title:"分配角色权限",onClick:K=>D(i)},null,8,["onClick"]),[[E,"btn.Role.assgin"]]),w(l(a,{plain:"",type:"warning",size:"small",icon:"Edit",title:"编辑角色",onClick:K=>N(i)},null,8,["onClick"]),[[E,"btn.Role.update"]]),l(g,{title:`确定要删除${i.roleName}吗？`,width:"200px",onConfirm:K=>S(i.id)},{reference:p(()=>[w(l(a,{plain:"",type:"danger",size:"small",icon:"Delete",title:"删除角色"},null,512),[[E,"btn.Role.remove"]])]),_:2},1032,["title","onConfirm"])],512),[[Z,!["超级管理员","管理员"].includes(i.roleName)]])]),_:1})]),_:1},8,["data"]),l(R,{pageNo:u(n).role.pageNo,"onUpdate:pageNo":e[3]||(e[3]=i=>u(n).role.pageNo=i),pageSize:u(n).role.pageSize,"onUpdate:pageSize":e[4]||(e[4]=i=>u(n).role.pageSize=i),pageSizes:[5,7,9],total:u(k),pageChange:u(V)},null,8,["pageNo","pageSize","total","pageChange"])]),_:1})])}}});const be=j(Ve,[["__scopeId","data-v-d139559c"]]),Se=I({__name:"index",setup(r){const n=L(),V=ie();ne(()=>{_()});const c=m([]),k=m(0);let s=m("");const _=()=>{V.load(async()=>{const t=await de(n.role.pageNo,n.role.pageSize,s.value);console.log(t),t.code===200?(c.value=t.data.records,k.value=t.data.total):C.error("获取角色数据失败")})};return $("getRoles",_),$("roles",c),$("total",k),(t,b)=>{const f=re;return T(),G("div",null,[l(f,{doSearch:_,modelValue:u(s),"onUpdate:modelValue":b[0]||(b[0]=N=>se(s)?s.value=N:s=N),title:"角色名"},null,8,["modelValue"]),l(be)])}}});export{Se as default};
