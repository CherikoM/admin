import{a1 as q,d as U,a2 as b,c as T,r as m,a3 as S,o as V,A as P,w as s,g as a,h as z,s as g,i as y,k as G,l as K,n as W,m as F,a4 as w,_ as H,a7 as $,a8 as J,e as L,K as B,x as O,aa as Q,a9 as R,ab as X,O as Y,W as Z}from"./index-4c180a68.js";/* empty css                      */import{u as ee}from"./el-popover-757eb6a2.js";/* empty css                   */const te=()=>q.get("/admin/acl/permission"),le=i=>i.id?q.put("/admin/acl/permission/update",i):q.post("/admin/acl/permission/save",i),ae=i=>q.delete("/admin/acl/permission/remove/"+i),oe=U({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(i,{emit:C}){const _=i,l=b("form",T({id:void 0,code:"",level:0,name:"",pid:0})),o=b("active",m({})),r=b("addMenu",m(!1)),v=b("getPermission",()=>{}),f=S({get:()=>_.modelValue,set:n=>C("update:modelValue",n)}),D=S(()=>r.value?`为${o.value.name}添加菜单`:`更新${o.value.name}`),d=m(),M=(n,e,u)=>{r.value||(l.name!==o.value.name||l.code!==o.value.code?(d.value.clearValidate(),u()):u(new Error("请更改输入")))},t=T({code:[{required:!0,message:"请输入权限值",trigger:"blur"},{validator:M,trigger:"blur"}],name:[{required:!0,message:"请输入权限名",trigger:"blur"},{validator:M,trigger:"blur"}]}),p=async()=>{try{await d.value.validate();const n=await le(l),e=r.value?"添加":"更新";n.code===200?(v(),f.value=!1,x(),y.success(`${e}目录成功`)):y.error(`${e}目录失败`)}catch{y.error("请检查输入")}};let c=!1;const E=()=>{f.value=!1,c=!0},h=async()=>{r.value?c&&(x(),c=!1):x(),d.value.clearValidate()},x=()=>{Object.assign(l,{id:void 0,code:"",level:0,name:"",pid:0}),d.value.clearValidate()};return(n,e)=>{const u=G,j=K,I=W,N=F,A=w;return V(),P(A,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=k=>f.value=k),title:D.value,width:"30%",onClosed:h},{footer:s(()=>[a(N,{plain:"",onClick:p},{default:s(()=>[z("提交")]),_:1}),a(N,{plain:"",onClick:E},{default:s(()=>[z("取消")]),_:1})]),default:s(()=>[a(I,{ref_key:"formEl",ref:d,model:g(l),rules:t,"label-width":"auto",class:"edit-form"},{default:s(()=>[a(j,{label:"权限名",prop:"name"},{default:s(()=>[a(u,{modelValue:g(l).name,"onUpdate:modelValue":e[0]||(e[0]=k=>g(l).name=k),modelModifiers:{trim:!0},placeholder:"请输入权限名"},null,8,["modelValue"])]),_:1}),a(j,{label:"权限值",prop:"code"},{default:s(()=>[a(u,{modelValue:g(l).code,"onUpdate:modelValue":e[1]||(e[1]=k=>g(l).code=k),modelModifiers:{trim:!0},placeholder:"请输入权限值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const se=H(oe,[["__scopeId","data-v-0f2fb2d4"]]),ne=U({__name:"index",setup(i){const C=b("permissions",m([])),_=b("getPermission",()=>{}),l=m(!1),o=T({id:void 0,code:"",level:0,name:"",pid:0}),r=m(!1),v=m({}),f=t=>{Object.assign(o,{level:t.level+1,pid:t.id}),d(t,!0)},D=t=>{Object.assign(o,{id:t.id,code:t.code,level:t.level,name:t.name,pid:t.pid}),d(t,!1)},d=(t,p)=>{l.value=!0,v.value=t,r.value=p},M=async t=>{(await ae(t)).code===200?(y.success("删除成功"),_()):y.error("删除失败")};return $("form",o),$("addMenu",r),$("active",v),(t,p)=>{const c=Q,E=F,h=R,x=X,n=J("perm");return V(),L("div",null,[a(x,{class:"table",data:g(C),"row-key":"id"},{default:s(()=>[a(c,{label:"菜单名",prop:"name"}),a(c,{label:"权限值",prop:"code"}),a(c,{label:"修改时间",prop:"updateTime"}),a(c,{label:"操作",width:"160px",align:"center"},{default:s(({row:e})=>[e.level<4?B((V(),P(E,{key:0,plain:"",type:"success",size:"small",icon:"Plus",title:`添加${e.level<=3?"菜单":"功能"}`,onClick:u=>f(e)},null,8,["title","onClick"])),[[n,"btn.Permission.add"]]):O("",!0),e.level!==1?B((V(),P(E,{key:1,plain:"",type:"warning",size:"small",icon:"Edit",title:"编辑菜单",onClick:u=>D(e)},null,8,["onClick"])),[[n,"btn.Permission.update"]]):O("",!0),e.level!==1?(V(),P(h,{key:2,title:`确定要删除${e.name}吗？`,width:"200px",onConfirm:u=>M(e.id)},{reference:s(()=>[B(a(E,{plain:"",type:"danger",size:"small",icon:"Delete",title:"删除菜单"},null,512),[[n,"btn.Permission.remove"]])]),_:2},1032,["title","onConfirm"])):O("",!0)]),_:1})]),_:1},8,["data"]),a(se,{modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=e=>l.value=e)},null,8,["modelValue"])])}}}),ue=U({__name:"index",setup(i){const C=ee();Y(()=>{l()});const _=m([]),l=async()=>{C.load(async()=>{const o=await te();o.code===200?_.value=o.data:y.error("获取菜单失败")})};return $("permissions",_),$("getPermission",l),(o,r)=>{const v=Z;return V(),P(v,null,{default:s(()=>[a(ne)]),_:1})}}});export{ue as default};
